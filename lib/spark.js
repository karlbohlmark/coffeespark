(function(){var a;a=function(){function a(a){this.template=a,this.tokens=[],this.listeners={token:[],error:[]},this.pos=0,this.length=this.template.length,this.last={},this.tags=[],this.insideTag=!1}a.prototype.currentToken=[],a.prototype.on=function(a,b){if(a!=="error"&&a!=="token")throw"Unsupported event:"+event;return this.listeners[a].push(b)},a.prototype.emit=function(a){var b,c,d,e,f;this.last=a,e=this.listeners.token,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b(a));return f},a.prototype.isAlpha=function(a){var b;b=a.charCodeAt(0);return 64<b&&b<91||96<b&&b<122},a.prototype.next=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if(this.deferred){(l=this.deferred)&&(this.deferred=null);return this.emit(l)}d=this.template[this.pos],f=this.template[this.pos+1],m=null;if(d==="<"&&f!=="/"){this.pos++,k=this.pos;while(this.isAlpha(this.template[this.pos])&&this.pos<this.length)this.pos++;this.template[this.pos]!==">"&&(this.insideTag=!0),n=this.template.substr(k,this.pos++ -k),this.tags.unshift(n);return this.emit({type:"tag",value:n})}if(d==="<"&&f==="/"){this.pos+=2,k=this.pos;while(this.isAlpha(this.template[this.pos])&&this.pos<this.length)this.pos++;n=this.template.substr(k,this.pos-k),e=this.tags.shift();if(n!==e)throw"expected "+e+" got "+n;this.pos++,this.insideTag=!1;return this.emit({type:"tagend",value:n})}if(!(this.pos>=this.length)){if(this.insideTag){if(this.template[this.pos]===">"){this.insideTag=!1,this.pos++;return!0}if(this.template[this.pos]==="/"&&this.template[this.pos+1]===">"){this.insideTag=!1,this.pos+=2,e=this.tags.shift();return this.emit({type:"tagend",value:e})}while(this.template[this.pos]===" "||!this.isAlpha(this.template[this.pos])&&this.pos<this.length)this.pos++;k=this.pos;while(this.isAlpha(this.template[this.pos])||this.template[this.pos]==="-")this.pos++;a=this.template.substr(k,this.pos-k),this.pos++,h=this.template[this.pos],k=++this.pos;while(this.template[this.pos]!==h)this.pos++;b=this.template.substr(k,this.pos++ -k),j=b.match(/\$\{[a-zA-Z_\-0-9]+\}/g),j&&j.length>0&&(i=j[0],i=i.substr(2,i.length-3),g=b.split(j[0]),b=[],g[0]!==""&&b.push({type:"content",value:g[0]}),b.push({type:"ref",value:i}),g[1]!==""&&b.push({type:"content",value:g[1]}));return this.emit({type:"attribute",name:a,value:b})}k=this.pos;while(this.template[this.pos]!=="<"&&this.pos<this.length&&(this.template[this.pos]!=="$"||this.template[this.pos+1]!=="{"))this.pos++;if(this.template[this.pos]==="$"&&this.template[this.pos+1]==="{"){c={type:"content",value:this.template.substr(k,this.pos-k)},this.pos+=2,k=this.pos;while(this.template[this.pos]!=="}"&&this.pos<this.length)this.pos++;this.deferred={type:"ref",value:this.template.substr(k,this.pos++ -k)};return this.emit(c)}this.pos-k===0&&console.log("theend");return this.emit({type:"content",value:this.template.substr(k,this.pos-k)})}};return a}(),exports.Lexer=a,typeof window!="undefined"&&(window.Lexer=a)}).call(this)